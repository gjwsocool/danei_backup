# 库函数模板创建

## 创建文件夹

`stm32f10x`

+ `stm32` → <font color=red>芯片系列前缀（STMicroelectronics 32-bit MCU）</font>
+ `f1 `→  <font color=red>F1 系列（基于 Cortex-M3）</font>
+ `0` →  <font color=red>细分型号代号（在标准库中固定写 0）</font>
+ `x` →  <font color=red>通配符，表示多种容量或型号</font>

![001](C:\Users\24732\Desktop\库函数模板文档\picture\001.png)

!![002](C:\Users\24732\Desktop\库函数模板文档\picture\002.png)

>    `core_cm3.h` `core_cm3.c`    ← <mark>Cortex-M3 内核寄存器定义和核心功能接口</mark>
>
>    `system_stm32f10x.c ` ← <mark>系统时钟初始化和核心频率更新函数实现</mark>
>    `system_stm32f10x.h  `←<mark> 相关函数声明和变量定义</mark>
>
>    `startup_stm32f10x_hd.s ` ←<mark> MCU 上电启动代码，中断向量表，中断入口</mark>

> + 目录：<font color=red>STM32F10X_StdPeriph_Driver</font>
> + `src 目录`存放的是外设驱动的源文件
> + `inc 目录`存放的是对应的头文件

----

!![003](C:\Users\24732\Desktop\库函数模板文档\picture\003.png)

## `keil`新建工程

> `创建一个新工程，名字是英文即可`
>
> ![005](C:\Users\24732\Desktop\库函数模板文档\picture\005.png)
>
> ![004](C:\Users\24732\Desktop\库函数模板文档\picture\004.png)

---

> keil自动生成了几个文件夹：
>
> ![006](C:\Users\24732\Desktop\库函数模板文档\picture\006.png)

+ <font color=red>**Listings**-----编译时产生的汇编代码、符号表、映射文件等文本信息，主要用于调试和查看编译细节</font>

+ <font color=red>**Objects**----- 有时也是中间文件夹，用于放置不同构建配置的中间文件。</font>

+ <mark>**libary_template.uvoptx** 和 **libary_template.uvprojx**</mark>

  + <font color=red>`.uvprojx` 是 Keil 工程文件，包含编译选项、文件列表、调试配置等</font>

  + <font color=red>`.uvoptx` 是工程的选项配置文件，保存调试和环境相关设置</font>

    <mark>这两个文件是` Keil 工程的核心配置文件`，缺一不可</mark>

## 选择组件

+ 头文件本质上**不需要手动加到工程编译列表**，只要它能被 `#include` 找到
+ 但要确保 Keil 的 **Include Paths**（在 C/C++ 选项卡里设置）包含了头文件所在路径

> 增加分组，然后加上文件，注意图标
>
> + 四个文件夹：`User`,`Startup`,`CMSIS`,`StdPeriph_Driver`
>
> ----
>
> ![007](C:\Users\24732\Desktop\库函数模板文档\picture\007.png)
>
> ---
>
> ![008](C:\Users\24732\Desktop\库函数模板文档\picture\008.png)

## 配置魔术棒

### 配置`Target`,`Listing`,`Output`

> 点击，然后配置obj

> ![009](C:\Users\24732\Desktop\库函数模板文档\picture\009.png)
>
> ![010](C:\Users\24732\Desktop\库函数模板文档\picture\010.png)

> Keil 里 **Output** 和 **Listing** 的输出路径是可以自定义的，默认放到 `Obj` 主要是为了简单集中管理，完全可以改成放到 `Listings` 文件夹。

### 配置`Debug`

![011](C:\Users\24732\Desktop\库函数模板文档\picture\011.png)

### 配置`C++`选项卡

> 在 C 语言里，宏（`#define`）是**预处理指令**，在编译前由预处理器做**条件编译**判断。
> ```c
> #ifdef STM32F10X_HD
>     // 这里放的是 STM32F103 高密度设备的寄存器地址、配置
> #endif
> 
> #ifdef STM32F10X_MD
>     // 这里放的是 STM32F103 中密度设备的寄存器地址、配置
> #endif
> ```

![012](C:\Users\24732\Desktop\库函数模板文档\picture\012.png)

> 加上宏和所有的头文件目录

<mark>接下来在main.c和APP文件定义功能即可</mark>
